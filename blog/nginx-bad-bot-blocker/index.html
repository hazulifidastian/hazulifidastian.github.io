<!DOCTYPE html>
<html lang="id-id" class="font-1-available">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.100.2" />


    <title>Nginx Bad Bot Blocker - Hazuli Fidastian</title>
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Nginx Bad Bot Blocker - Hazuli Fidastian">
    <title itemprop="name">Nginx Bad Bot Blocker | Hazuli Fidastian</title>
    <meta name="twitter:title" content="Nginx Bad Bot Blocker | Hazuli Fidastian" />
    <meta itemprop="name" content="Nginx Bad Bot Blocker | Hazuli Fidastian" />
    <meta name="application-name" content="Nginx Bad Bot Blocker | Hazuli Fidastian" />
    <meta property="og:site_name" content="" />


    <link href='https://hazulifidastian.github.io/favicon.ico' rel='icon' type='image/x-icon' />










<base href="https://hazulifidastian.github.io/blog/nginx-bad-bot-blocker/">
<link rel="canonical" href="https://hazulifidastian.github.io/blog/nginx-bad-bot-blocker/" itemprop="url" /> 
<meta name="url" content="https://hazulifidastian.github.io/blog/nginx-bad-bot-blocker/" />
<meta name="twitter:url" content="https://hazulifidastian.github.io/blog/nginx-bad-bot-blocker/" /> 
<meta property="og:url" content="https://hazulifidastian.github.io/blog/nginx-bad-bot-blocker/" />

<meta name="robots" content="index,follow" /> 
<meta name="googlebot" content="index,follow" />
<meta name="google-site-verification" content="Won_YvYvA2MlMOjNNvvHeLbAwVOs3Qt9-Dbaj-MtHAo" />


<meta name="theme-color" content="#1997A5" /> 
<meta name="msapplication-TileColor" content="#1997A5" />

<meta name="keywords" content="" />
<meta name="imagemode" content="force" />
<meta name="coverage" content="Worldwide" /> 
<meta name="distribution" content="Global" />
<meta name="HandheldFriendly" content="True" /> 
<meta name="msapplication-tap-highlight" content="no" />
<meta name="apple-mobile-web-app-title" content="" /> 
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-touch-fullscreen" content="yes" /> 

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
<link rel="stylesheet" href="https://hazulifidastian.github.io/css/main.css" media="all">
<link disabled id="night-mode-theme" rel="stylesheet" href="/css/night.css">

  </head>
  <body>
    <header class="header">
      <nav class="nav">
  <div class="nav-circle">
    <div class="bg"></div>
    <div class="bg bg2"></div>
    <div class="bg bg3"></div>
    <a href="https://hazulifidastian.github.io/" class="nav-logo">
      <img src="https://hazulifidastian.github.io/images/logo.png" 
          width="80" 
          height="80" 
          alt="Logo">
    </a>
  </div>
  
</nav>

    </header>


<main role="main">
  <div class="container">
    <article class="article">
      <div class="article-section">
        <a class="article-section" href="https://hazulifidastian.github.io/notes/">notes</a>
      </div>

      <h1 class="article-title">Nginx Bad Bot Blocker</h1>

      <div class="article-meta">
        <span class="article-date">
          
    
    

    
    
    Senin, 13 Juni 2022



        </span>
        
          <svg style="position:relative; bottom: -2px;" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather-icon"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          <span class="article-duration">3 min read</span>
        
      </div>

      

      

      <div class="article-content">
        <h3 id="bagian-1-instalasi">Bagian 1, Instalasi</h3>
<p>Download <code>install-ngxblocker</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo wget https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/install-ngxblocker -O /usr/local/sbin/install-ngxblocker
</span></span><span style="display:flex;"><span>sudo chmod +x /usr/local/sbin/install-ngxblocker
</span></span></code></pre></div><p>Jalankan <code>install-ngxblocker</code> dengan mode DRY-MODE/DRY-RUN untuk melihat peubahan apa yang dibuat dan file apa saja yang didownload.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#111">cd</span> /usr/local/sbin
</span></span><span style="display:flex;"><span>sudo ./install-ngxblocker
</span></span></code></pre></div><p>Dengan DRY-MODE, script hanya melakukan simulasi setup.</p>
<p>Jalankan <code>install-ngxblocker</code> dengan parameter <code>-x</code> untuk benar-benar mendownload file yang diperlukan.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#111">cd</span> /usr/local/sbin
</span></span><span style="display:flex;"><span>sudo ./install-ngxblocker -x
</span></span></code></pre></div><p>Script ini akan membuat folder <code>/etc/nginx/bots.d</code> dan mendownload file konfigurasi yang diperlukan ke folder tersebut. Juga akan mendownload file <code>setup-ngxblocker</code> dan <code>update-ngxblocker</code> ke folder <code>/usr/local/sbin</code>.</p>
<p>Ganti mode script setup dan update agar bisa dieksekusi mandiri.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod +x /usr/local/sbin/setup-ngxblocker
</span></span><span style="display:flex;"><span>sudo chmod +x /usr/local/sbin/update-ngxblocker
</span></span></code></pre></div><h3 id="bagian-2-setup">Bagian 2, Setup</h3>
<p>Jalankan <code>setup-ngxblocker</code> dengan mode DRY-MODE/DRY-RUN. Tidak ada perubahan dan file yang akan didownload.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#111">cd</span> /usr/local/sbin/
</span></span><span style="display:flex;"><span>sudo ./setup-ngxblocker
</span></span></code></pre></div><p>Script ini juga akan menambahkan IP server anda ke dalam <code>whitelist-ips.conf</code> pada <code>/etc/nginx/bots.d/whitelist-ips.conf</code></p>
<p>Setup otomatis. Setup ini akan berhasil jika struktur folder konfigurasi anda terdapat <code>sites-available</code>. Jika tidak, lihat bagian <strong>Setup manual</strong>.</p>
<p>Jalankan <code>setup-ngxblocker</code> dengan parameter <code>-x</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#111">cd</span> /usr/local/sbin/
</span></span><span style="display:flex;"><span>sudo ./setup-ngxblocker -x
</span></span></code></pre></div><p>Jika file konfigurasi anda di folder sites-available memiliki extensi <code>.conf</code> tambahkan parameter <code>-e conf</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#111">cd</span> /usr/local/sbin/
</span></span><span style="display:flex;"><span>sudo ./setup-ngxblocker -x -e conf
</span></span></code></pre></div><p>Script ini akan menambahkan</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Bad Bot Blocker</span>
</span></span><span style="display:flex;"><span>include /etc/nginx/bots.d/ddos.conf<span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>include /etc/nginx/bots.d/blockbots.conf<span style="color:#111">;</span>
</span></span></code></pre></div><p>ke file konfigurasi <code>.conf</code> anda.</p>
<p>Setup manual.</p>
<ul>
<li>
<p>Salin;</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Bad Bot Blocker</span>
</span></span><span style="display:flex;"><span>include /etc/nginx/bots.d/ddos.conf<span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>include /etc/nginx/bots.d/blockbots.conf<span style="color:#111">;</span>
</span></span></code></pre></div><p>ke file konfigurasi virtual host anda yang sudah ada di folder <code>conf.d</code>, misalnya <code>default.conf</code>. Saya menggunakan Nginx docker, file konfigurasi default adalah <code>/etc/nginx/conf.d/default.conf</code></p>
</li>
<li>
<p>Tambahkan IP anda ke file <code>/etc/nginx/bots.d/whitelist-ips.conf</code></p>
</li>
<li>
<p>Jika menggunakan docker, tambahkan juga IP host ke file <code>whitelist-ips.conf</code></p>
</li>
<li>
<p>Jika Nginx disetup dibelakang router/proxy, tambahkan juga IP router/proxynya jika IP tersebut yang digunakan untuk mengakses Nginx.</p>
</li>
</ul>
<p>Test validitas konfigurasi</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nginx -t
</span></span></code></pre></div><p>hasilnya harus;</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span style="display:flex;"><span>nginx: configuration file /etc/nginx/nginx.conf <span style="color:#111">test</span> is successful
</span></span></code></pre></div><p>Reload/restart Nginx</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nginx -t <span style="color:#f92672">&amp;&amp;</span> sudo nginx -s reload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># atau;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo service nginx restart
</span></span></code></pre></div><h3 id="bagian-3-auto-update-konfigurasi-mandiri-dan-test">Bagian 3, Auto-update, Konfigurasi Mandiri dan Test</h3>
<p>Setup crontab untuk otomatis update blocker</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo crontab -e
</span></span></code></pre></div><p>Update setiap jam 10 malam dan informasi update akan dikirim ke email;</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">22</span> * * * sudo /usr/local/sbin/update-ngxblocker -e yourname@youremail.com
</span></span></code></pre></div><p>Blocker akan mengupdate dirinya sendiri dan memangil ulang Nginx setelah versi terakhir file <code>globalblacklist.conf</code> selesai didownload.</p>
<p>Konfigurasi mandiri</p>
<p>Lokasi file konfigurasi yang bisa disesuaikan mandiri;</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/etc/nginx/bots.d/whitelist-ips.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/whitelist-domains.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/blockbots.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/blacklist-domains.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/blacklist-user-agents.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/blacklist-ips.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/bad-referrer-words.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/custom-bad-referrers.conf
</span></span><span style="display:flex;"><span>/etc/nginx/bots.d/ddos.conf
</span></span></code></pre></div><p>Testing</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -A <span style="color:#d88200">&#34;Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)&#34;</span> -I http://yourdomain.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -A <span style="color:#d88200">&#34;Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)&#34;</span> -I http://yourdomain.com
</span></span></code></pre></div><p>Harus mengembalikan respon <strong>200 OK</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -A <span style="color:#d88200">&#34;Xenu Link Sleuth/1.3.8&#34;</span> -I http://yourdomain.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -A <span style="color:#d88200">&#34;Mozilla/5.0 (compatible; AhrefsBot/5.2; +http://ahrefs.com/robot/)&#34;</span> -I http://yourdomain.com
</span></span></code></pre></div><p>Harus mengembalikan salah satu pesan berikut;</p>
<ul>
<li>curl: (52) Empty reply from server</li>
<li>curl: (56) TCP connection reset by peer</li>
<li>curl: (92) HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -I http://yourdomain.com -e http://100dollars-seo.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -I http://yourdomain.com -e http://zx6.ru
</span></span></code></pre></div><p>Harus mengembalikan salah satu pesan berikut;</p>
<ul>
<li>curl: (52) Empty reply from server</li>
<li>curl: (56) TCP connection reset by peer</li>
<li>curl: (92) HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1)</li>
</ul>


        
<div class="article-tags block mt-6 mb-6">
  
  <a class="tag is-black" href="https://hazulifidastian.github.io/tags/nginx/">#nginx</a
  >&nbsp;
  
  <a class="tag is-black" href="https://hazulifidastian.github.io/tags/security/">#security</a
  >&nbsp;
  
</div>


      </div>
    </article>

    
  </div>
</main>

<footer class="footer">
    <ul class="footer-links">
        
        <li>
            <a id="night-mode-toggle" title="Toggle Night/Light mode" class="footer-links-kudos"
                data-current-mode="light" style="cursor: pointer;"></a>
        </li>
        <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img
                    src="https://hazulifidastian.github.io/images/hugo-logo.png" width="22" height="22" alt="Hugo logo"></a>
        </li>
    </ul>
</footer>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-9380146-9', 'auto');
	
	ga('send', 'pageview');
}
</script>

<script src="/js/night_toggle.js"></script>

</body>

</html>

